{% extends "base.html" %}

{% block title %}Novo Equipamento | Sistema de Gestão Patrimonial{% endblock %}
{% block description %}Cadastrar novo equipamento no sistema patrimonial{% endblock %}

{% block extra_head %}
<script>
    if (typeof tailwind !== 'undefined') {
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                colors: {
                    'dark': {
                        '800': '#1e293b',
                        '850': '#172033', 
                        '900': '#0f172a',
                        '950': '#020617',
                    },
                    'accent': {
                        '400': '#60a5fa',
                        '500': '#3b82f6',
                        '600': '#2563eb',
                    },
                    'success-dark': '#10b981',
                    'warning-dark': '#f59e0b',
                    'danger-dark': '#ef4444',
                    'info-dark': '#06b6d4',
                },
                animation: {
                    'fade-in': 'fadeIn 0.5s ease-in-out',
                    'slide-up': 'slideUp 0.3s ease-out',
                    'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    'float': 'float 6s ease-in-out infinite',
                },
                keyframes: {
                    fadeIn: {
                        '0%': { opacity: '0' },
                        '100%': { opacity: '1' },
                    },
                    slideUp: {
                        '0%': { transform: 'translateY(10px)', opacity: '0' },
                        '100%': { transform: 'translateY(0)', opacity: '1' },
                    },
                    float: {
                        '0%, 100%': { transform: 'translateY(0px)' },
                        '50%': { transform: 'translateY(-10px)' },
                    },
                },
            },
        },
    };
    }
</script>

<style>
    .form-step {
        display: none;
    }
    .form-step.active {
        display: block;
    }
    .step-indicator {
        transition: all 0.3s ease;
    }
    .step-indicator.completed {
        background-color: #10b981;
        color: white;
    }
    .step-indicator.active {
        background-color: #3b82f6;
        color: white;
    }
    
    .card-hover {
        transition: all 0.3s ease;
    }
    
    .card-hover:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(59, 130, 246, 0.2), 0 0 20px rgba(59, 130, 246, 0.15), 0 0 40px rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.3);
    }
</style>

<script>
    let currentStep = 1;
    const totalSteps = 3;

    function showStep(step) {
        document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
        document.getElementById(`step-${step}`).classList.add('active');
        
        document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
            indicator.classList.remove('active', 'completed');
            if (index + 1 < step) {
                indicator.classList.add('completed');
            } else if (index + 1 === step) {
                indicator.classList.add('active');
            }
        });

        document.getElementById('prev-btn').style.display = step === 1 ? 'none' : 'block';
        document.getElementById('next-btn').style.display = step === totalSteps ? 'none' : 'block';
        document.getElementById('submit-btn').style.display = step === totalSteps ? 'block' : 'none';
    }

    function nextStep() {
        if (validateStep(currentStep)) {
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            }
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
        }
    }

    function validateStep(step) {
        const requiredFields = document.querySelectorAll(`#step-${step} [required]`);
        let isValid = true;

        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.classList.add('border-red-500');
                isValid = false;
            } else {
                field.classList.remove('border-red-500');
            }
        });

        if (!isValid) {
            showNotification('Por favor, preencha todos os campos obrigatórios.', 'warning');
        }

        return isValid;
    }

    function generateSerial() {
        const categoria = document.getElementById('categoria').value;
        const prefix = categoria ? categoria.substring(0, 3).toUpperCase() : 'EQP';
        const timestamp = Date.now().toString().slice(-6);
        const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        document.getElementById('serial').value = `${prefix}${timestamp}${random}`;
    }

    function calculateDepreciation() {
        const valor = parseFloat(document.getElementById('valor_aquisicao').value) || 0;
        const dataAquisicao = new Date(document.getElementById('data_aquisicao').value);
        const hoje = new Date();
        const anosUso = (hoje - dataAquisicao) / (1000 * 60 * 60 * 24 * 365);
        const vidaUtil = 5;
        const depreciacao = Math.max(0, valor - (valor * anosUso / vidaUtil));
        
        document.getElementById('valor_atual').value = depreciacao.toFixed(2);
    }

    function previewImage(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('image-preview');
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `<img src="${e.target.result}" class="w-full h-48 object-cover rounded-lg">`;
            };
            reader.readAsDataURL(file);
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        showStep(1);
        
        // Update summary in real-time
        document.addEventListener('input', function(e) {
            const field = e.target;
            const summaryElement = document.getElementById(`summary-${field.name}`);
            if (summaryElement) {
                summaryElement.textContent = field.value || '-';
            }
        });
    });
</script>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <header class="mb-6 sm:mb-8">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mt-16 sm:mt-0">
            <div>
                <h1 class="text-2xl sm:text-3xl font-bold text-white">
                    Cadastrar Novo Equipamento
                </h1>
                <p class="mt-1 text-sm sm:text-base text-gray-400">
                    Adicione um novo item ao patrimônio institucional
                </p>
            </div>
            
            <div class="flex items-center space-x-2 sm:space-x-3">
                <a href="/equipamentos/" 
                   class="bg-gray-700 text-gray-300 font-semibold py-3 px-4 sm:px-6 rounded-lg shadow-md transition duration-300 hover:bg-gray-600 flex items-center text-sm sm:text-base touch-manipulation min-h-[44px]">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    <span class="whitespace-nowrap">Voltar</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Progress Steps -->
    <div class="mb-8 bg-gray-800 shadow-2xl shadow-black/50 rounded-xl p-6">
        <div class="flex items-center justify-center space-x-8">
            <div class="flex items-center">
                <div class="step-indicator w-10 h-10 rounded-full bg-gray-600 flex items-center justify-center text-sm font-medium">1</div>
                <span class="ml-2 text-sm font-medium text-gray-300">Informações Básicas</span>
            </div>
            <div class="w-16 h-1 bg-gray-600"></div>
            <div class="flex items-center">
                <div class="step-indicator w-10 h-10 rounded-full bg-gray-600 flex items-center justify-center text-sm font-medium">2</div>
                <span class="ml-2 text-sm font-medium text-gray-300">Detalhes Técnicos</span>
            </div>
            <div class="w-16 h-1 bg-gray-600"></div>
            <div class="flex items-center">
                <div class="step-indicator w-10 h-10 rounded-full bg-gray-600 flex items-center justify-center text-sm font-medium">3</div>
                <span class="ml-2 text-sm font-medium text-gray-300">Finalização</span>
            </div>
        </div>
    </div>

    <!-- Form -->
    <form action="/equipamentos/create" method="POST" enctype="multipart/form-data" class="bg-gray-800 shadow-2xl shadow-black/50 rounded-xl p-8">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <!-- Step 1: Basic Information -->
        <div id="step-1" class="form-step">
            <h3 class="text-xl font-semibold text-white mb-6">Informações Básicas</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="nome" class="block text-sm font-medium text-gray-300 mb-2">Nome do Equipamento *</label>
                    <input type="text" id="nome" name="nome" required
                           class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150 hover:bg-gray-600"
                           placeholder="Ex: Notebook Dell Inspiron 15">
                </div>

                <div>
                    <label for="categoria" class="block text-sm font-medium text-gray-300 mb-2">Categoria *</label>
                    <select id="categoria" name="categoria" required onchange="generateSerial()"
                            class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150">
                        <option value="">Selecione uma categoria</option>
                        <option value="NOTEBOOK">Notebook</option>
                        <option value="DESKTOP">Desktop</option>
                        <option value="IMPRESSORA">Impressora</option>
                        <option value="TABLET">Tablet</option>
                        <option value="CELULAR">Celular</option>
                        <option value="PROJETOR">Projetor</option>
                        <option value="ROTEADOR">Roteador</option>
                        <option value="ACCESS POINT">Access Point</option>
                        <option value="TV">TV</option>
                        <option value="CAIXA DE SOM">Caixa de Som</option>
                        <option value="PERIFERICOS">Periféricos</option>
                    </select>
                </div>

                <div>
                    <label for="marca" class="block text-sm font-medium text-gray-300 mb-2">Marca *</label>
                    <input type="text" id="marca" name="marca" required
                           class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150 hover:bg-gray-600"
                           placeholder="Ex: Dell, HP, Lenovo">
                </div>

                <div>
                    <label for="modelo" class="block text-sm font-medium text-gray-300 mb-2">Modelo</label>
                    <input type="text" id="modelo" name="modelo"
                           class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150 hover:bg-gray-600"
                           placeholder="Ex: Inspiron 15 3000">
                </div>

                <div>
                    <label for="serial" class="block text-sm font-medium text-gray-300 mb-2">Número de Série *</label>
                    <div class="flex">
                        <input type="text" id="serial" name="serial" required
                               class="flex-1 p-3 border border-gray-600 bg-gray-700 text-white rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150"
                               placeholder="Número de série único">
                        <button type="button" onclick="generateSerial()"
                                class="px-4 py-3 bg-blue-600 text-white rounded-r-lg hover:bg-blue-500 transition-colors">
                            Gerar
                        </button>
                    </div>
                </div>

                <div>
                    <label for="emprestimo" class="block text-sm font-medium text-gray-300 mb-2">Status Inicial *</label>
                    <select id="emprestimo" name="emprestimo" required
                            class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150">
                        <option value="DISPONIVEL">Disponível</option>
                        <option value="EM_USO">Em Uso</option>
                        <option value="QUEBRADO">Quebrado</option>
                    </select>
                </div>
            </div>

            <div class="mt-6">
                <label for="descricao" class="block text-sm font-medium text-gray-300 mb-2">Descrição</label>
                <textarea id="descricao" name="descricao" rows="3"
                          class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150 hover:bg-gray-600"
                          placeholder="Descrição detalhada do equipamento..."></textarea>
            </div>
        </div>

        <!-- Step 2: Technical Details -->
        <div id="step-2" class="form-step">
            <h3 class="text-xl font-semibold text-white mb-6">Detalhes Técnicos e Financeiros</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="setor" class="block text-sm font-medium text-gray-300 mb-2">Setor *</label>
                    <select id="setor" name="setor" required
                            class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150">
                        <option value="">Selecione o setor</option>
                        <option value="CJ">CJ</option>
                        <option value="CCA">CCA</option>
                        <option value="CEI">CEI</option>
                        <option value="ADMINISTRATIVO">Administrativo</option>
                        <option value="RH">RH</option>
                        <option value="TI">TI</option>
                        <option value="COMUNICACAO">Comunicação</option>
                        <option value="SOCIAL">Social</option>
                        <option value="FINANCEIRO">Financeiro</option>
                        <option value="PRODUCAO">Produção</option>
                        <option value="ARRASTART">Arrastart</option>
                        <option value="ENFERMARIA">Enfermaria</option>
                    </select>
                </div>

                <div>
                    <label for="localizacao" class="block text-sm font-medium text-gray-300 mb-2">Localização</label>
                    <input type="text" id="localizacao" name="localizacao"
                           class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150 hover:bg-gray-600"
                           placeholder="Ex: Sala 101, Andar 2">
                </div>

                <div>
                    <label for="valor_aquisicao" class="block text-sm font-medium text-gray-300 mb-2">Valor de Aquisição *</label>
                    <input type="number" id="valor_aquisicao" name="valor_aquisicao" step="0.01" required onchange="calculateDepreciation()"
                           class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150 hover:bg-gray-600"
                           placeholder="0.00">
                </div>

                <div>
                    <label for="valor_atual" class="block text-sm font-medium text-gray-300 mb-2">Valor Atual</label>
                    <input type="number" id="valor_atual" name="valor_atual" step="0.01" readonly
                           class="w-full p-3 border border-gray-600 bg-gray-600 text-gray-300 rounded-lg focus:outline-none"
                           placeholder="Calculado automaticamente">
                </div>

                <div>
                    <label for="data_aquisicao" class="block text-sm font-medium text-gray-300 mb-2">Data de Aquisição *</label>
                    <input type="date" id="data_aquisicao" name="data_aquisicao" required onchange="calculateDepreciation()"
                           class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150">
                </div>

                <div>
                    <label for="fornecedor" class="block text-sm font-medium text-gray-300 mb-2">Fornecedor</label>
                    <input type="text" id="fornecedor" name="fornecedor"
                           class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150 hover:bg-gray-600"
                           placeholder="Nome do fornecedor">
                </div>

                <div>
                    <label for="garantia_ate" class="block text-sm font-medium text-gray-300 mb-2">Garantia até</label>
                    <input type="date" id="garantia_ate" name="garantia_ate"
                           class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150">
                </div>

                <div>
                    <label for="cargo" class="block text-sm font-medium text-gray-300 mb-2">Cargo</label>
                    <select id="cargo" name="cargo"
                            class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150">
                        <option value="">Selecione o cargo</option>
                        <option value="GERENTE">Gerente</option>
                        <option value="COORDENADOR">Coordenador</option>
                        <option value="ASSISTENTE">Assistente</option>
                        <option value="AUXILIAR">Auxiliar</option>
                        <option value="ANALISTA">Analista</option>
                        <option value="EDUCADOR">Educador</option>
                        <option value="DIRETORIA">Diretoria</option>
                        <option value="ENFERMEIRA">Enfermeira</option>
                        <option value="RH">RH</option>
                    </select>
                </div>
            </div>

            <div class="mt-6">
                <label for="especificacoes" class="block text-sm font-medium text-gray-300 mb-2">Especificações Técnicas</label>
                <textarea id="especificacoes" name="especificacoes" rows="4"
                          class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150 hover:bg-gray-600"
                          placeholder="Ex: Processador Intel i5, 8GB RAM, SSD 256GB, Tela 15.6&quot;..."></textarea>
            </div>
        </div>

        <!-- Step 3: Finalization -->
        <div id="step-3" class="form-step">
            <h3 class="text-xl font-semibold text-white mb-6">Finalização</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="imagem" class="block text-sm font-medium text-gray-300 mb-2">Foto do Equipamento</label>
                    <input type="file" id="imagem" name="imagem" accept="image/*" onchange="previewImage(event)"
                           class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150">
                    <p class="mt-1 text-sm text-gray-400">PNG, JPG até 5MB</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Pré-visualização</label>
                    <div id="image-preview" class="w-full h-48 border-2 border-dashed border-gray-600 rounded-lg flex items-center justify-center">
                        <div class="text-center">
                            <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p class="text-sm text-gray-400">Nenhuma imagem selecionada</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                <div>
                    <label for="anydesk" class="block text-sm font-medium text-gray-300 mb-2">Número AnyDesk</label>
                    <input type="text" id="anydesk" name="anydesk"
                           class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150 hover:bg-gray-600"
                           placeholder="Ex: 123456789">
                </div>
                <div>
                    <label for="compartilhado" class="block text-sm font-medium text-gray-300 mb-2">Equipamento Compartilhado</label>
                    <select id="compartilhado" name="compartilhado"
                            class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150">
                        <option value="NAO">Não</option>
                        <option value="SIM">Sim</option>
                    </select>
                </div>
            </div>
            
            <div class="mt-6">
                <label for="observacoes" class="block text-sm font-medium text-gray-300 mb-2">Observações Adicionais</label>
                <textarea id="observacoes" name="observacoes" rows="4"
                          class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition duration-150 hover:bg-gray-600"
                          placeholder="Informações adicionais, histórico, condições especiais..."></textarea>
            </div>

            <div class="mt-6 p-4 bg-blue-900/20 rounded-lg">
                <h4 class="text-sm font-medium text-blue-200 mb-2">Resumo do Cadastro</h4>
                <div class="text-sm text-blue-300 space-y-1">
                    <p><strong>Nome:</strong> <span id="summary-nome">-</span></p>
                    <p><strong>Categoria:</strong> <span id="summary-categoria">-</span></p>
                    <p><strong>Marca:</strong> <span id="summary-marca">-</span></p>
                    <p><strong>Setor:</strong> <span id="summary-setor">-</span></p>
                    <p><strong>Valor:</strong> R$ <span id="summary-valor_aquisicao">0,00</span></p>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between mt-8 pt-6 border-t border-gray-700">
            <button type="button" id="prev-btn" onclick="prevStep()" 
                    class="bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 hover:bg-gray-500 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
                Anterior
            </button>

            <button type="button" id="next-btn" onclick="nextStep()" 
                    class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 hover:bg-blue-500 flex items-center">
                Próximo
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                </svg>
            </button>

            <button type="submit" id="submit-btn" 
                    class="bg-green-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 hover:bg-green-500 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Cadastrar Equipamento
            </button>
        </div>
    </form>
</div>
{% endblock %}